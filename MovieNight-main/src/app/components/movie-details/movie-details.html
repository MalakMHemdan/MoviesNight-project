<div class="movie-details-container mt-48 mb-0" [hidden]="loading || !movie">
  <div class="movie-header ">
    <div class="poster-section ">
      <img
        [src]="movie?.poster ? 'http://localhost:5003/Images/' + movie.poster : 'https://via.placeholder.com/500x750/1a1a1a/fbbf24?text=No+Image'"
        [alt]="movie?.title?.primary"
        class="movie-poster"
        (error)="onImgError($event)">
    </div>

    <div class="movie-info">
      <h1 class="movie-title">{{ movie?.title?.primary }}</h1>

      <div class="movie-meta">
        <span class="rating">⭐ {{ movie?.rating?.percent || 0 }}</span>
        <span class="release-date">{{ movie?.year?.start }}</span>
      </div>

      @if (movie?.genres?.length) {
        <div class="genres">
          @for (genre of movie.genres; track genre) {
            <span class="genre-tag">{{ genre }}</span>
          }
        </div>
      }

      @if (movie?.crew?.directors?.length) {
        <div class="director-info">
          <h3>Director</h3>
          <p>{{ movie.crew.directors[0].name }}</p>
        </div>
      }

      <div class="actions">
        <button class="wishlist-btn" (click)="movie && toggleWishlist(movie)" [class.active]="movie && isWishlisted(movie)">
          <i [ngClass]="movie && isWishlisted(movie) ? 'fa-solid fa-heart' : 'fa-regular fa-heart'"></i>
          {{ movie && isWishlisted(movie) ? 'Remove from Wishlist' : 'Add to Wishlist' }}
        </button>
      </div>
    </div>
  </div>

  <div class="recommendations-section">
    <h2>Recommendations</h2>
    <div class="recommendations-grid">
      @for (rec of recommendations; track rec.tconst) {
        <div class="recommendation-card" (click)="rec && goToMovieDetails(rec.tconst)">
          <div class="rec-poster">
            <img
              [src]="rec?.poster ? 'http://localhost:5003/Images/' + rec.poster : 'https://via.placeholder.com/300x450/1a1a1a/fbbf24?text=No+Image'"
              [alt]="rec?.title?.primary"
              (error)="onImgError($event, 'rec')">
          </div>
          <div class="rec-info">
            <h4>{{ rec?.title?.primary }}</h4>
            <span class="rec-rating">⭐ {{ rec?.rating?.percent || 0 }}</span>
          </div>
        </div>
      }
    </div>
  </div>
</div>

@if (loading) {
  <div class="loading">
    <p>Loading movie details...</p>
  </div>
}

@if (!loading && !movie) {
  <div class="error pb-5">
    <p>Movie not found</p>
    <button (click)="goBack()">Go Back</button>
  </div>
}
